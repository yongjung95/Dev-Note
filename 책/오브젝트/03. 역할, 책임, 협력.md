# 3장 역할, 책임, 협력
## 01 협력
### 영화 예매 시스템 돌아보기
- 협력
  - 객체들이 애플리케이션의 기능을 구현하기 위해 수행하는 상호작용을 `협력`이라고 한다.
- 책임
  - 객체가 협력에 참여하기 위해 수행하는 로직을 `책임`이라고 부른다.
- 역할
  - 객체들이 협력 안에서 수행하는 책임들이 모여 객체가 수행하는 `역할`을 구성한다.
  
### 협력
- 객체는 고립된 존재가 아니라 시스템의 기능이라는 더 큰 목표를 달성하기 위해 다른 객체와 협력하는 사회적인 존재다.
  - 협력은 객체지향의 세계에서 `기능을 구현할 수 있는 유일한 방법`이다.
- `메시지 전송`은 객체 사이의 협력을 위해 사용할 수 있는 유일한 커뮤니케이션 수단이다.
  - 메시지를 수신한 객체는 `메서드`를 실행해 요청에 응답한다.
  - 여기서 객체가 메시지를 처리할 방법을 `스스로 선택한다는 점이 중요`하다.
- 자율적인 객체는 자신에게 할당된 책임을 수행하던 중에 필요한 정보를 알지 못하거나 외부의 도움이 필요한 경우 `적절한 객체에게 메시지를 전송해서 협력을 요청`한다.
  - 이처럼 객체들 사이의 협력을 구성하는 일련의 요청과 응답의 흐름을 통해 애플리케이션의 기능이 구현된다.

### 협력이 설계를 위한 문맥을 결정한다
- 애플리케이션 안에 어떤 객체가 필요하다면 그 이유는?
  - `객체가 어떤 협력에 참여`하고 있기 때문이다.
  - 그리고 그 객체가 협력에 참여할 수 있는 이유는 `협력에 필요한 적절한 행동을 보유`하고 있기 때문이다.
- 결론적으로 `객체의 행동을 결정하는 것은 객체가 참여하고 있는 협력`이다.
- 객체의 행동을 결정하는 것이 `협력`이라면 객체의 상태를 결정하는 것은 `행동`이다.
- 객체의 상태는 `그 객체가 행동을 수행하는 데 필요한 정보가 무엇인지로 결정`된다.
  - 객체는 `자신의 상태를 스스로 결정하고 관리하는 자율적인 존재이기 때문에 객체가 수행하는 행동에 필요한 상태도 함께 가지고 있어야 한다.`
- 상태는 `객체가 행동하는 데 필요한 정보에 의해 결졍`되고, 행동은 `협력 안에서 객체가 처리할 메시지로 결정`된다.
  - 결과적으로 `객체가 참여하는 협력이 객체를 구성하는 행동과 상태 모두를 결정`한다.
  - 따라서 `협력은 객체를 설계하는 데 필요한 일종의 문맥을 제공`한다.


## 02. 책임
### 책임이란 무엇인가
- 책임이란 `객체에 의해 정의되는 응집도 있는 행위의 집합`으로, 객체가 유지해야 하는 정보와 수행 할 수 있는 행동에 대해 개략적으로 서술한 문장이다.
- 객체의 책임을 두 가지 범주로 나누어 세분화한다.
  - 하는 것
    - 객체를 생성하거나 계산을 수행하는 등의 스스로 하는 것
    - 다른 객체의 행동을 시작시키는 것
    - 다른 객체의 활동을 제어하고 조절하는 것
  - 아는 것
    - 사적인 정보에 관해 아는 것
    - 관련된 객체에 관해 아는 것
    - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것
- 협력 안에서 객체에게 할당된 책임이 `외부의 인터페이스와 내부의 속성을 결정`한다.
- 일반적으로 책임과 메시지의 크기는 다르다.
  - 책임은 `객체가 수행할 수 있는 행동을 종합적이고 간략하게 서술`하기 때문에 `메시지보다 추상적이고 개념적으로도 더 크다.`
- 객체는 `자신이 맡은 책임을 수행하는 데 필요한 정보를 알고 있을 책임`이 있다.
  - 또한 객체는 `자신이 할 수 없는 작업을 도와줄 객체를 알고 있을 책임`이 있다.
  - 이것은 `객체에게 책임을 할당하기 위한 가장 기본적인 원칙에 대한 힌트를 제공`한다.
- 협력이 중요한 이유는 `객체에게 할당할 책임을 결정할 수 있는 문맥을 제공`하기 때문이다.
  - `적절한 협력이 적절한 책임을 제공`하고, `적절한 책임을 적절한 객체에게 할당해야만 단순하고 유연한 설계를 창조`할 수 있다.
- 객체지향 설계에서 가장 중요한 것은 `책임`이다.

### 책임 할당
- 자율적인 객체를 만드는 가장 기본적인 방법은 `책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당하는 것`이다.
- 따라서 객체에게 `책임을 할당하기 위해서는 먼저 협력이라는 문맥을 정의`해야 한다.
  - 협력을 설계하는 출발점은 `시스템이 사용자에게 제공하는 기능을 시스템이 담당할 하나의 책임으로 바라보는 것`이다.
- 객체지향 설계는 `협력에 필요한 메시지를 찾고 메시지에 적절한 객체를 선택하는 반복적인 과정`을 통해 이뤄진다.
  - 그리고 이런 `메시지가 메시지를 수신할 객체의 책임을 결정`한다.
  - 이렇게 결정된 `메시지가 객체의 퍼블릭 인터페이스를 구성`한다는 것 역시 눈여겨보기 바란다.
  - 최종적으로 얻게되는 결과물은 `시스템을 구성하는 객체들의 인터페이스와 오퍼레이션의 목록`이다.
- `정보 전문가(객체)에게 책임을 할당하는 것만으로도 상태와 행동을 함께 가지는 자율적인 객체를 만들 가능성이 높아지기 때문`이다.

### 책임 주도 설계
- `책임을 찾고 책임을 수행할 적절한 객체를 찾아 책임을 할당하는 방식으로 협력을 설계하는 방법`을 책임 주도 설계라고 부른다.
- 책임 주도 설계 방법의 과정
  - 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.
  - 시스템 책임을 더 작은 책임으로 분할한다.
  - 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
  - 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
  - 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.
- 협력은 `객체를 설계하기 위한 구체적인 문맥을 제공`한다.
  - `협력이 책임을 이끌어내고 책임이 협력에 참여할 객체를 결정`한다.
- 구현이 아닌 책임에 집중하는 것이 중요한 이유는 `유연하고 견고한 객체지향 시스템을 위해 가장 중요한 재료가 바로 책임`이기 때문이다.

### 메시지가 객체를 결정한다
- 객체가 메시지를 선택하는 것이 아니라 메시지가 객체를 선택하게 했다는 것이 중요하다.
- 메시지가 객체를 선택하게 해야 하는 이유
  - `객체가 최소한의 인터페이스를 가질 수 있게 된다.`
    - 필요한 메시지가 식별될 때까지 객체의 퍼블릭 인터페이스에 어떤 것도 추가하지 않기 때문에 객체는 애플리케이션에 크지도, 작지도 않은 꼭 필요한 크기의 퍼블릭 인터페이스를 가질 수 있다.
  - `객체는 충분히 추상적인 인터페이스를 가질 수 있게 된다.`
    - 메시지는 외부의 객체가 요청하는 무언가를 의미하기 때문에 메시지를 먼저 식별하면 무엇을 수행할지에 초점을 맞추는 인터페이스를 얻을 수 있다.
- 객체가 충분히 추상적이면서 미니멀리즘을 따르는 인터페이스를 가지게 하고 싶다면 `메시지가 객체를 선택`하게 하라.

### 행동이 상태를 결정한다
- 객체를 객체답게 만드는 것은 객체의 상태가 아니라 `객체가 다른 객체에게 제공하는 행동`이다.
- 객체의 행동은 `객체가 협력에 참여할 수 있는 유일한 방법`이다.
  - 객체가 협력에 적합한지를 결정하는 것은 그 객체의 상태가 아니라 행동이다.
  - 얼마나 적절한 객체를 창조했느냐는 얼마나 `적절한 책임을 할당`했느냐에 달려있고, 책임이 얼마나 적절한지는 `협력에 얼마나 적절`한가에 달려있다.
- `협력이라는 문맥 안에서 객체를 생각`해야 한다.
  - 협력 관계 속에서 다른 객체에게 무엇을 제공해야 하고 다른 객체로부터 무엇을 얻어야 하는지를 고민해야만 `훌륭한 책임을 수확`할 수 있다.
- 객체가 가질 수 있는 상태는 행동을 결정하고 나서야 비로소 결정할 수 있다.
  - `협력이 객체의 행동을 결정`하고 `행동이 상태를 결정`한다.


## 03. 역할
### 역할과 협력
- 객체의 목적은 협력 안에서 객체가 맡게 되는 책임의 집합으로 표시된다.
  - 이처럼 객체가 어떤 특정한 협력 안에서 수행하는 책임의 집합을 `역할`이라고 부른다.
- 실제로 협력을 모델링할 때는 `특정한 객체가 아니라 역할에게 책임을 할당`한다고 생각하는 게 좋다.

### 유연하고 재사용 가능한 협력
- 역할이 중요한 이유는 `역할을 통해 유연하고 재사용 가능한 협력`을 얻을 수 있기 때문이다.
- 역할을 추상화하게 되면 `동일한 책임을 수행하는 역할을 기반으로 두 개의 협력을 하나로 통합`할 수 있다는 것이다.
  - 따라서 `역할을 이용하면 불필요한 중복 코드를 제거` 할 수 있다.
  - 더 좋은 소식은 `협력이 더 유연`해졌다는 점이다.
- `책임과 역할을 중심으로 협력을 바라보는 것이 바로 변경과 확장이 용이한 유연한 설계`로 나아가는 첫 걸음이다.

### 객체 대 역할
- 설계 초밥에는 `적절한 책임과 협력의 큰 그림을 탐색하는 것이 가장 중요한 목표`여야 하고 `역할과 객체를 명확하게 구분하는 것은 그렇게 중요하지 않다는 것`이다.
  - 따라서 애매하다면 `단순하게 객체로 시작하고 반복적으로 책임과 협력을 정제해가면서 필요한 순간에 객체로부터 역할을 분리해내는 것이 가장 좋은 방법`이다.
- 중요한 것은 `협력을 구체적인 객체가 아니라 추상적인 역할의 관점에서 설계하면 협력이 유연하고 재사용 가능해진다는 것`이다.
  - 따라서 역할의 가장 큰 장점은 `설계의 구성 요소를 추상화할 수 있다는 것`이다.

### 역할과 추상화
- 추상화를 이용한 설계가 가질 수 있는 두 가지 장점
  - `세부 사항에 억눌리지 않고도 상위 수준의 정책을 쉽고 간단하게 표현`할 수 있다는 것이다.
    - 추상화를 적절하게 사용하면 `불필요한 세부 사항을 생략하고 핵심적인 개념을 강조`할 수 있다.
    - 상위 수준에서 협력을 설명하면 `구체적인 객체들이 가지는 복잡성을 제거하고 단순화해서 표현`할 수 있다.
    - 예) '가격 할인 정책과 함께 2개의 순번 규칙과 1개의 비율 규칙을 적용', '비율 할인 정책과 함께 3개의 순번 규칙을 적용' -> '할인 정책과 여러 개의 할인 조건을 적용'한다
  - `설계가 좀 더 유연해진다는 것`이다.
    - 협력 안에서 동일한 책임을 수행하는 객체들은 `동일한 역할을 수행하기 때문에 서로 대체 가능`하다.
    - 따라서 역할은 `다양한 환경에서 다양한 객체들을 수용할 수 있게 해주므로 협력을 유연`하게 만든다.

### 배우와 배역
- 협력이라는 문맥 안에서 `역할은 특정한 협력에 참여해서 책임을 수행하는 객체의 일부`다.
- 객체는 `여러 역할을 가질 수 있지만 특정한 협력 안에서는 일시적으로 오직 하나의 역할만이 보여진다는 점에 주의`하라.
  - 이것은 `배우가 하나의 연극에서 오직 하나의 배역을 연기하는 것과 동일`하다.
- 객체는 `다양한 역할을 가질 수 있다.`
  - 객체는 협력에 참여할 때 협력 안에서 `하나의 역할`로 보여준다.
  - 객체가 다른 협력에 참여할 때는 다른 역할로 보여준다.
  - 협력의 관점에서 `동일한 역할을 수행하는 객체들은 서로 대체 가능`하다.
  - 역할은 `특정한 객체의 종류를 캡슐화하기 때문에 동일한 역할을 수행하고 계약을 준수하는 대체 가능한 객체들은 다형적`이다.