# 1장 도메인 모델 시작하기

## 1.1 도메인이란?
![img.png](사진폴더/1.2%20소프트웨어가%20도메인의%20모든%20기능을%20제공하진%20않는다.png)
- 도메인은 **소프트웨어로 해결하고자 하는 문제 영역**
- 도메인은 **다시 하위 도메인으로 나눌 수 있으며, 다른 하위 도메인과 연동하여 완전한 기능을 제공**한다.
  - 고객이 물건을 구매하면 주문, 결제, 배송, 혜택 하위 도메인의 기능이 엮이게 된다.
- 특정 도메인을 위한 소프트웨어라고 해서 **도메인이 제공해야 할 모든 기능을 직접 구현하는 것**은 아니다.
  - [그림 1.2]에서 배송 도메인의 일부 기능은 자체 시스템으로 구현하고, 나머지 기능은 외부 업체의 시스템을 사용한다.
- 도메인마다 **고정된 하위 도메인이 존재하는 것**은 아니다.


## 1.2 도메인 전문가와 개발자 간 지식 공유
- 개발자는 요구사항을 분석하고 설계하여 코드를 작성하며 테스트하고 배포한다.
  - 코딩에 앞서 **요구사항을 올바르게 이해하는 것이 중요.**
  - 요구사항을 잘못 이해하면 변경하거나 다시 만들어야 할 코드가 많아지고, 제품을 만드는데 실패하거나 일정이 크게 밀리기도 한다.
- 요구사항을 올바르게 이해하려면 **개발자와 전문가가 직접 대화하는 것**이다.
  - 내용을 전파하는 전달자가 많으면 많을수록 정보가 왜곡되고 손실이 발생하게 되어, 개발자는 최초에 전문가가 요구한 것과는 다른 무언가를 만들게 된다.
- 도메인 전문가 만큼은 아니겠지만 **이해관계자와 개발자도 도메인 지식을 갖춰야 한다.**
  - **제품 개발과 관련된 모든 사람이 같은 지식을 공유하고 직접 소통할수록 도메인 전문가 원하는 제품을 만들 가능성이 높아진다.**


## 1.3 도메인 모델
![img_1.png](사진폴더/1.3%20객체%20기반%20주문%20도메인%20모델.png)
- 도메인 모델에는 다양한 정의가 존재하는데, 기본적으로 **도메인 모델은 특정 도메인을 개념적으로 표현한 것**이다.
  - 도메인 모델을 사용하면 **여러 관계자들이 동일한 모습으로 도메인을 이해하고 도메인 지식을 공유하는 데 도움**이 된다.
  - [그림 1.3]은 객체를 이용한 도메인 모델이다. **기능과 데이터를 함께 보여주는 객체 모델은 모델링하기에 적합**하다.
- 도메인 모델을 객체로만 모델링할 수 있는 것은 아니다.
  - 클래스 다이어그램이나 상태 다이어그램과 같은 UML 표기법을 사용해도 된다.
  - 계산 규칙이 중요하다면 수학 공식을 활용해서 도메인 모델을 만들 수도 있다.
- **도메인을 이해하는 데 도운이 된다면 표현 방식이 무엇인지는 중요하지는 않다.**
- 도메인 모델은 **기본적으로 도메인 자첼르 이해하기 위한 개념 모델**이다.
  - 개념 모델을 이용해서 바로 코드를 작성할 수 있는 것은 아니기에 **구현 기술에 맞는 구현 모델이 따로 필요**하다.
- 개념 모델과 구현 모델은 서로 다른 것이지만 구현 모델이 개념 모델을 최대한 따르도록 할 수는 있다.
  - 객체 기반 모델 기반 -> 객체 지향 언어를 이용한 구현 모델
  - 수학적 모델 -> 함수를 이용한 구현 모델


## 1.4 도메인 모델 패턴
- 도메인 모델은 **아키텍처 상의 도메인 계층을 객체 지향 기법으로 구현하는 패턴**을 말한다.
- 도메인 계층은 **도메인의 핵심 규칙을 구현**한다.
- **도메인 규칙을 객체 지향 기법으로 구현하는 패턴이 도메인 모델 패턴**이다.
  - 주문 도메인의 경우 '출고 전에 배송지를 변경 할 수 있다'라는 규칙과 '주문 취소는 배송 전에만 할 수 있다' 라는 규칙을 구현한 코드가 도메인 계층에 위치하게 된다.
- **핵심 규칙을 구현한 코드는 도메인 모델에만 위치하기 때문에 규칙이 바뀌거나 규칙을 확장해야 할 때 다른 코드에 영향을 덜 주고 변경 내역을 모델에 반영**할 수 있게 된다.
  - 배송지 변경 가능 여부를 판단하는 기능이 Order에 있든 OrderStatus에 있든 중요한 점은 **주문과 관련된 중요 업무 규칙을 주문 도메인 모델인 Order나 OrderStatus에서 구현한다는 점**


### ✅ 개념 모델과 구현 모델 ✅
- 프로젝트 초기에 완벽한 도메인 모델을 만들더라도 결국 도메인에 대한 새로운 지식이 쌓이면서 몯레을 보완하거나 변경하는 일이 발생한다.
- 따라서 프로젝트 초기에는 **개요 수준의 개념 모델로 도메인에 대한 전체 윤곽을 이해하는 데 집중**하고, **구현하는 과정에서 개념 모델을 구현 모델로 점진적으로 발전**시켜야 한다.


## 1.5 도메인 모델 도출
- 제아무리 뛰어난 개발자라 할지라도 도메인에 대한 이해 없이 코딩을 시작할 수는 없다 ❌
  - **도메인 모델 초안을 만들어야 비로소 코드를 작성**할 수 있다. 
  - 화이트보드, 종이와 연필, 모델링 툴 중 무엇을 선택하든 구현을 시작하려면 **도메인에 대한 초기 모델이 필요**하다.


### ✅ 문서화 ✅
- 문서화를 하는 주된 이유는 지식을 공유하기 위함이다.
- 코드를 보면서 도메인을 깊게 이해하게 되므로 코드 자체도 문서화의 대상이 된다.
  - 단순히 코드를 보기 좋게 작성하는 것뿐만 아니라 **도메인 관점에서 코드가 도메인을 잘 표현해야 비로소 코드의 가족성이 높아지고 문서로서 코드가 의미**를 갖는다.


## 1.6 엔티티와 밸류
- 도출한 모델은 크게 **엔티티**와 **밸류**로 구분할 수 있다.
- 엔티티와 밸류를 제대로 구분해야 도메인을 올바르게 설계하고 구현할 수 있기 때문에 **이 둘의 차이를 명확하게 이해하는 것은 도메인을 구현하는 데 있어 중요**하다. 

### 1.6.1 엔티티
- 엔티티의 가장 큰 특징은 식별자를 가진다는 것이다.
  - 엔티티 객체마다 고유해서 각 엔티티는 서로 다른 식별자를 갖는다.
  - **엔티티를 생성하고 속성을 바꾸고 삭제할 때까지 식별자는 유지**된다.

### 1.6.2 엔티티의 식별자 생성
- 특정 규칙에 따라 생성
- UUID나 Nano ID와 같은 고유 식별자 생성기 사용
- 값을 직접 입력
- 일련번호 사용(시퀀스나 DB의 자동 증가 칼럼 사용)
- **식별자를 중복해서 입력하지 않도록 사전에 방지하는 것이 중요**하다.

### 1.6.3 밸류 타입
- **밸류 타입을 사용함으로써 개념적으로 완전한 하나를 잘 표현할 수 있는 것**이다.
- 밸류 타입이 꼭 두 개 이상의 데이터를 가져야 하는 것은 아니고, **의미를 명확하게 표현하기 위해 밸류 타입을 사용하는 경우**도 있다.
- 밸류 타입의 장점
  - 밸루 타입을 위한 기능을 추가할 수 있다는 것이다.
- **밸류 객체의 데이터를 변경할 때는 기존 데이터를 변경하기보다는 변경한 데이터를 갖는 새로운 밸류 객체를 생성하는 방식을 선호**한다.
  - 데이터 변경 기능을 제공하지 않는 타입을 **불변**이라고 표현한다.
  - **안전한 코드를 작성할 수 있다는 점이 불변으로 구현하는 이유**이다.

### 1.6.4 엔티티 식별자와 밸류 타입
- 식별자를 위한 밸류 타입을 사용해서 의미가 잘 드러나도록 할 수 있다.

### 1.6.5 도메인 모델에 set 메서드 넣지 않기
- 도메인 모델에 get/set 메서드를 무조건 추가하는 것은 **좋지 않은 버릇**이다.
  - **특히 set 메서드는 도메인의 핵심 개념이나 의도를 코드에서 사라지게 한다.**
- 도메인 객체를 생성할 때 온전하지 않은 상태가 될 수 있다.
  - **불완전한 상태로 사용되는 것을 막으려면 생성 시점에 필요한 것을 전달**해 주어야 한다.
  - **즉 생성자를 통해 필요한 데이터를 모두 받아야 한다.**


## 1.7 도메인 용어와 유비쿼터스 언어
- 코드를 작성할 때 **도메인에서 사용하는 용어는 매우 중요**하다.
  - 도메인에서 사용하는 용어를 코드에 반영하지 않으면 그 코드는 개발자에게 코드의 의미를 해석해야 하는 부담을 준다.
- 도메인 용어를 사용해서 구현하면, **코드를 도메인 용어로 해석하거나 도메인 용어를 코드로 해석하는 과정**이 줄어든다.
- **도메인에 대한 이해가 높아지는데 새롭게 이해한 내용을 잘 표현할 수 있는 용어를 찾아내고 이를 다시 공통의 언어로 만들어 다 같이 사용**한다.
- **새로 발견한 용어는 코드나 문서에도 반영해서 산출물에 최신 모델을 적용**한다.
- 도메인 용어는 좋은 코드를 만드는 데 매우 중요한 요소임에 틀림없지만 국내 개발자는 이 점에 있어 불리한 점이 있다.
  - 바로 영어인데, **알맞은 영단어를 찾는 것은 쉽지 않은 일이지만 시간을 들여 찾는 노력**을 해야 한다.